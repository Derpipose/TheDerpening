name: DerpeningProject
run-name: Derp is derping
on: [push, workflow_dispatch]

jobs: 
  Deployment:
    runs-on: self-hosted
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: Setup .NET Core
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: 8.0.102

      - name: Set up Tests
        run: |
          ls
          cd TheDerpeningTesting
          console.WriteLine("I have made it to the docker");
          docker compose up -d --build
          sleep 5
          docker compose exec -T  -e DOTNET_CLI_HOME="/tmp/dotnet" --user $(id -u):$(id -g) derp-testing dotnet test
    
          
      - name: Clean up Tests
        if: always()
        run: |
          cd TheDerpeningTesting
          docker compose down --remove-orphans --volumes

      - name: Getting Production Ready
        run: |
          cd TheDerpening
          docker compose down --remove-orphans
          docker compose up -d --build

      - name: Formatting Ensured
        run: dotnet format --verify-no-changes --verbosity diagnostic 